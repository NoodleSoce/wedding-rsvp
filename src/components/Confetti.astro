---
// Confetti - optimized, respects reduced motion
---

<script>
  import confetti from "canvas-confetti";

  let timer: number;

  function run() {
    if (!document.querySelector(".page[data-target]")) return;
    if (matchMedia("(prefers-reduced-motion: reduce)").matches) return;

    const end = Date.now() + 2500;

    clearInterval(timer);
    timer = setInterval(() => {
      if (Date.now() > end) return clearInterval(timer);

      confetti({
        particleCount: 25,
        spread: 360,
        startVelocity: 20,
        ticks: 40,
        origin: { x: Math.random() * 0.4 + 0.1, y: Math.random() * 0.25 },
        zIndex: 0,
      });

      confetti({
        particleCount: 25,
        spread: 360,
        startVelocity: 20,
        ticks: 40,
        origin: { x: Math.random() * 0.4 + 0.5, y: Math.random() * 0.25 },
        zIndex: 0,
      });
    }, 200) as unknown as number;
  }

  document.addEventListener("astro:page-load", () => {
    requestAnimationFrame(() => setTimeout(run, 100));
  });

  document.addEventListener("astro:before-swap", () => {
    clearInterval(timer);
    confetti.reset?.();
  });
</script>
