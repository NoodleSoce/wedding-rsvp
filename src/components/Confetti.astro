---
// Confetti - slower, content area only, respects reduced motion
---

<script>
  import confetti from "canvas-confetti";

  let timer: number;

  function run() {
    const page = document.querySelector(".page[data-target]");
    if (!page) return;
    if (matchMedia("(prefers-reduced-motion: reduce)").matches) return;

    // Get the content area bounds
    const content = page.querySelector(".content");
    const rect = content?.getBoundingClientRect();

    // Calculate origin based on content position
    const originY = rect
      ? (rect.top + rect.height * 0.3) / window.innerHeight
      : 0.2;
    const leftX = rect ? rect.left / window.innerWidth : 0.2;
    const rightX = rect ? rect.right / window.innerWidth : 0.8;

    // Slower: 4.5 seconds duration, 400ms interval
    const end = Date.now() + 4500;

    clearInterval(timer);
    timer = setInterval(() => {
      if (Date.now() > end) return clearInterval(timer);

      // Left burst - within content area
      confetti({
        particleCount: 15,
        spread: 70,
        startVelocity: 12,
        ticks: 80,
        gravity: 0.7,
        origin: {
          x: leftX + Math.random() * 0.15,
          y: originY + Math.random() * 0.1,
        },
        zIndex: 0,
      });

      // Right burst - within content area
      confetti({
        particleCount: 15,
        spread: 70,
        startVelocity: 12,
        ticks: 80,
        gravity: 0.7,
        origin: {
          x: rightX - Math.random() * 0.15,
          y: originY + Math.random() * 0.1,
        },
        zIndex: 0,
      });
    }, 400) as unknown as number;
  }

  document.addEventListener("astro:page-load", () => {
    requestAnimationFrame(() => setTimeout(run, 300));
  });

  document.addEventListener("astro:before-swap", () => {
    clearInterval(timer);
    confetti.reset?.();
  });
</script>
