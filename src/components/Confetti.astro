---
// Confetti - slower, optimized, respects reduced motion
---

<script>
  import confetti from "canvas-confetti";

  let timer: number;

  function run() {
    if (!document.querySelector(".page[data-target]")) return;
    if (matchMedia("(prefers-reduced-motion: reduce)").matches) return;

    // Slower: 4 seconds duration, 350ms interval
    const end = Date.now() + 4000;

    clearInterval(timer);
    timer = setInterval(() => {
      if (Date.now() > end) return clearInterval(timer);

      confetti({
        particleCount: 20,
        spread: 300,
        startVelocity: 15,
        ticks: 60,
        gravity: 0.8,
        origin: { x: Math.random() * 0.4 + 0.1, y: Math.random() * 0.2 },
        zIndex: 0,
      });

      confetti({
        particleCount: 20,
        spread: 300,
        startVelocity: 15,
        ticks: 60,
        gravity: 0.8,
        origin: { x: Math.random() * 0.4 + 0.5, y: Math.random() * 0.2 },
        zIndex: 0,
      });
    }, 350) as unknown as number;
  }

  document.addEventListener("astro:page-load", () => {
    requestAnimationFrame(() => setTimeout(run, 200));
  });

  document.addEventListener("astro:before-swap", () => {
    clearInterval(timer);
    confetti.reset?.();
  });
</script>
