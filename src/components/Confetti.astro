---
// Confetti - random positions in content area
---

<script>
  import confetti from "canvas-confetti";

  let timer: number;

  function run() {
    const page = document.querySelector(".page[data-target]");
    if (!page) return;
    if (matchMedia("(prefers-reduced-motion: reduce)").matches) return;

    // Get content area bounds
    const content = page.querySelector(".content");
    const rect = content?.getBoundingClientRect();

    if (!rect) return;

    // Calculate content area in viewport percentages
    const contentLeft = rect.left / window.innerWidth;
    const contentRight = rect.right / window.innerWidth;
    const contentWidth = contentRight - contentLeft;
    const contentTop = rect.top / window.innerHeight;

    // Duration and interval
    const end = Date.now() + 4500;

    clearInterval(timer);
    timer = setInterval(() => {
      if (Date.now() > end) return clearInterval(timer);

      // Random position within content area
      const randomX = contentLeft + Math.random() * contentWidth;
      const randomY = contentTop + Math.random() * 0.3;

      confetti({
        particleCount: 12,
        spread: 50,
        startVelocity: 10,
        ticks: 80,
        gravity: 0.6,
        origin: { x: randomX, y: randomY },
        zIndex: 0,
      });
    }, 300) as unknown as number;
  }

  document.addEventListener("astro:page-load", () => {
    requestAnimationFrame(() => setTimeout(run, 300));
  });

  document.addEventListener("astro:before-swap", () => {
    clearInterval(timer);
    confetti.reset?.();
  });
</script>
